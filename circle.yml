deployment:
  staging:
    branch: master
    heroku:
      appname: hotel-booking-resize-service

machine:
  java:
    version: oraclejdk8

  environment:
    # Add the Postgres 9.6 binaries to the path.
    PATH: /usr/lib/postgresql/9.6/bin/:$PATH

    pre:
      # Start Postgres 9.6 since the default is 9.5.
      - sudo service postgresql stop
      - sudo mv /usr/lib/postgresql-9.6/9.6 /usr/lib/postgresql/9.6
      - sudo mv /etc/postgresql-9.6/9.6 /etc/postgresql/9.6
      - sudo service postgresql start 9.6

      # Add a password to the `ubuntu` user, since Postgres is configured to
      # always ask for a password, and without out it will fail.
      - sudo -u postgres psql -p 5433 -c "create user ubuntu with password 'ubuntu';"
      - sudo -u postgres psql -p 5433 -c "alter user ubuntu with superuser;"

      # Create a new test database.
      - sudo -u postgres psql -p 5433 -c "create database test;"

    DATABASE_URL: jdbc:postgresql://localhost:5433/hotel?user=ubuntu&password=ubuntu
    # postgres://ubuntu:@127.0.0.1:5433/test

dependencies:
  override:
    - chmod +x gradlew
    - ./gradlew dependencies

